#          ████████     ██████
#         █░░░░░░░░██_██░░░░░░█
#        █░░░░░░░░░░░█░░░░░░░░░█
#       █░░░░░░░███░░░█░░░░░░░░░█
#       █░░░░███░░░███░█░░░████░█
#     █░░░██░░░░░░░░███░██░░░░██
#    █░░░░░░░░░░░░░░░░░█░░░░░░░░███
#    █░░░░░░░░░░░░░██████░░░░░████░░█
#    █░░░░░░░░░█████░░░████░░██░░██░░█
#   ██░░░░░░░███░░░░░░░░░░█░░░░░░░░███
#  █░░░░░░░░░░░░░░█████████░░█████████
# █░░░░░░░░░░█████ ████   ████ █████ █
# █░░░░░░░░░░█      █ ███   █   ███ █ █
#█░░░░░░░░░░░░█   ████ ████    ██ ████
#░░░░░░░░░░░░░█████████░░░████████░░░█
#░░░░░░░░░░░░░░░░█░░░░░█░░░░░░░░░░░░█
#░░░░░░░░░░░░░░░░░░░░██░░░░█░░░░░░██
#░░░░░░░░░░░░░░░░░░██░░░░░░░███████
#░░░░░░░░░░░░░░░░██░░░░░░░░░░█░░░░░█                                            _____                                 _____                                            _____                                                   _____
#░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░█                                          /\    \                               /\    \                                          /\    \                                                 /\    \
#░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░█                      ::                 /::\    \                             /::\    \                                        /::\____\                                               /::\____\
#░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░█                                        /::::\    \                           /::::\    \           :::         ::           ::: ::/    /                         :                   :: ::/    /
#░░░░░░░░░░░█████████░░░░░░░░░░░░░░██                                       /::::::\    \                         /::::::\    \                               ::: : :::/    /                                              /:::/    /
#░░░░░░░░░░█▒▒▒▒▒▒▒▒███████████████▒▒█                                     /:::/\:::\    \                    :: ::::/\:::\    \                                  /:::/    /                                              /:::/    /
#░░░░░░░░░█▒▒███████▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒█                                    /:::/__\:::\    \                     /:::/__\:::\    \                                /:::/    /                                            :::: :/____/
#░░░░░░░░░█▒▒▒█▓▓▓▓██████████████████                                    /::::\   \:::\    \                   /::::\   \:::\    \                              /:::/    /                                              /::::\    \
#░░░░░░░░░██▒▒█▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█                                       /::::::\   \:::\    \                 /::::::\   \:::\    \                            /:       /      _____                                   /::::::\    \   _____
#░░░░░░░░░░█▒▒█▓█████████████████ ████                                 /:::/\:::\   \:::\ ___\               /:::/\:::\   \:::\____\                          /:::/____/      /\    \                                 /:::/\:::\    \ /\    \
#░░░░░░░░░░█▒▒██▓▓▒▓▒▓▒▓▒▒▒▒▒▒▒▒▓█▓▒▒▒█                               /:::/__\:::\   \:::|    |             /:::/  \:::\   \:::|    |                         :::|    /      /::\____\                        ::::::: :::/ : :::\    /::\____\
#░░░░░░░░░█▒▒████████▓▒███▓██▒▒▒▒▒▒▒▒▒█                  :            \:::\   \:::\  /:::|____|             \::/   |::::\  /:::|____|                      : :: :|____\     /:::/    /                               \::/    \:::\: ::::/    /
#░░░░░░░░░█▒▒▒▒▒▒▒▒▒█████████████▓█▓██                                 \:::\   \:::\/:::/    /               \/____|:::::\/:::/    /                          \:::\    \   /:::/    /                                 \/____/: :::\/:::/    /
#░░░░░░░░░░████████▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒█                                  \:::\   \::::::/    /                      |:::::::::/    /                            \:::\   :: : ::/    /                                 :  :  : : :::::::/    /
#░░░░░░░░░░░░░░░░░░██████████████████                                    \:::\   \::::/    /          :  :         |::|\::::/    /           ::                 \:::\    /:::/    /               ::::                          \::       /
#░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░█            ::                           \:::\  /:::/    /                      :: ::| \::/____/                                \:::\__/:::/    /                                              /:::/    /
#██░░░░░░░░░░░░░░░░░░░░░░░░░░░██                                           \:::\/:::/    /                         |::|  ~|                                       \::::::::/    /                                             : :::/    /
#▓██░░░░░░░░░░░░░░░░░░░░░░░░██                                              \::::::/    /                          |::|   |                                        \::::::/    /                                              /:::/    /
#▓▓▓███░░░░░░░░░░░░░░░░░░░░█                                                 \::::/    /                           \::|   |                                         \::::/    /                              ::: :           /:::/    /
#▓▓▓▓▓▓███░░░░░░░░░░░░░░░██                                 :                 \::/____/            :                \:|   |               :    ::::                  \::/____/                                               \::/    /
#▓▓▓▓▓▓▓▓▓███████████████▓▓█                                                   ⠋                                     \|___|                                           ⠩                                                      \/____/
#▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓██
#▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█                                                                                                                                                                                                                                               |                                                                    |                                      |
#▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█                                                                    |                                                                                                             |
#______________________________                                                                                                                       |                                                                                                                      |                                                                                                                                              |                    |
#___________________________
#_ ______ _____ _________
# /            /                                                         |                                |                       |                    |                |                       |                    |                |                       |                    |                     |                       |                    |

#        \                          |                                |                                               |  |                                          |                    |                                          |                       |                    |  |                                           |                    |        |                    |                              |


#      |               |                                 |

#                  |                                                |            |                                   |                               |                           |                               |                           |                               |                                |                               |
#           |                                  |                                     |

#                  |                     |                                                     |                                   |                               |     |                                   |                               |     |                                   |                               |          |                                   |                               |
#   |                          |                       |                    |
#           |                                    |                                         |     |                    |                                    | |     |                    |                                    | |     |                    |                                    |      |     |                                                        |
#      |                        |                                 |      |                                |                       |                    |                |                       |                    |                |                       |                    |                     |                       |                    |

#                      |                                                |      |                                   |                               |                         |                               |                         |                               |                              |                               |
#           |                                   |                               |                   |                                |                       |                    |          |                                |                       |                    |          |                                |                       |                    |               |                                |                                        |

#                  |                     |
#   |                                |                       |                    |            |                                |                       |                    |     |                                |                       |                    |     |                                |                       |                              |                                |
#           |                               |                                         |                              |                       |                    |                           |                       |                    |                           |                       |                    |                                |                       |                    |

#   |         |                                   PRESENTATION                                                |                                |                    |   |                                |                    |   |                                |                    |        |                                |                    |
#                                                                                                                               |                               |     |                                   |                               |     |                                   |                               |          |                                   |                               |
#                |                            |                 |                          |                                                                              |                               |     |                                   |                               |     |                                   |                               |          |                                   |                               |

#        |                         Ce trieur permet de calculer le prix plus

#                              rapidement pour des artistes cotés AKOU tels que                      |                                           |               |                                           |               |                                           |                    |                                           |

#                 Nathacha , artiste peintre de l'abstraction https://www.artnathacha.com/                |                                |                                          |      |                                |                                          |      |                                |                                          |           |                                |
#                                                                                                    |                                                                 |                      |                     |                       |                      |                     |                       |                      |                     |                            |

#      |                        |                                         |                                |                       |                    |                |                       |                    |                |                       |                    |                    |                                           |

#                   |            |                   Anyway          |                        |                                         |                                |                       |                    |                |                       |                    |                |                       |                    |                    |

#              |                      |                 have                                                 |                        |                                         |                                |                       |                    |                |                       |                    |                |                       |                    |                     |                                           |


#                 |                                  FUN         |                        |                                         |                                |                       |                    |                |                       |                    |                |                       |                    |                    |                                                                      |

#                                                         =)

#
#                                |                      or                                       |                                                            |                    |                |                       |                    |                |                       |                    |                    |                                           |


#              |                              |       DIE ! !         |                       |                            |                |                       |                    |                |                       |                    |                    |                                           |#      |                        |                                         |                                |

#
#                                                     !                                       |                                |                    |  |                                |                    |  |                                |                    |       |                                |                    |

#      |               |                                 !

#                  |                                                |            |                                   |                               |                           |                               |                           |                               |                                |                               |
#           |                                  !                                     |

#                  |                     |                                                     |                                   |                               |     |                                   |                               |     |                                   |                               |          |                                   |                               |
#   |                          |                       |                    |
#           |                                    |                                         |     |                    |                                    | |     |                    |                                    | |     |                    |                                    |      |     |                    |                                    |
#      |                        |                                 |      |                                |                       |                    |                |                       |                    |                |                       |                    |                    |                                           |

#                      |                                                |      |                                   |                               |                         |                               |                         |                               |                              |                               |
#           |                                   |                               |                   |                                |                       |                    |          |                                |                       |                    |          |                                |                       |                    |               |                                                                |

#                  |                     |
#   |                                |                       |                    |            |                                |                       |                    |     |                                |                       |                    |                                    |                       |                              |                                                                        |
#           |                               |                                         |                              |                       |                    |                           |                       |                    |                           |                       |                    |                                |                       |                    |

#_ _  _ ____ ___ ____ _    _    ____ ___ _ ____ _  _
#| |\ | [__   |  |__| |    |    |__|  |  | |  | |\ |
#| | \| ___]  |  |  | |___ |___ |  |  |  | |__| | \|

import sys
import os
from PyQt5.QtWidgets import QApplication, QMainWindow, QPushButton, QFileDialog, QLabel, QLineEdit, QScrollArea, QTextEdit
from PyQt5.QtGui import QIntValidator, QIcon
from PyQt5.QtCore import Qt

#___  ____ _ _ _ ____ ____    ___  _    ____ _  _ ___
#|__] |  | | | | |___ |__/    |__] |    |__| |\ |  |
#|    |__| |_|_| |___ |  \    |    |___ |  | | \|  |


#OPENING | https://www.youtube.com/watch?v=_85LaeTCtV8 :3

#function to make an exe file with py to exe
def ressource_path(relative_path):
    try:
        base_path=sys._MEIPASS
    except Exception:
        base_path = os.path.abspath('.')
    return os.path.join(base_path ,relative_path)
#to make it works, you have to rename all your path with ressource_path (/path/) WHEN YOU WILL TURN THE SCRIPT TO EXE
#Example : /icon/lol.png  BECOME  ressource_path(/icon/lol.png)



#___  ____ ____ ____ ____ ____ _  _
#|__] |__/ |  | | __ |__/ |__| |\/|
#|    |  \ |__| |__] |  \ |  | |  |



#Création d'une classe contenant nos fonctions et boutons principaux
class trieur(QMainWindow):
    def __init__(self):
        super().__init__()
        self.GUI()
        

#On passe mainteant à la création de la feneetre utilisateur :

    def GUI(self):

        self.setFixedSize(200,300) #La taille largeur, hauteur
        self.setWindowTitle("TRI") 
        self.setWindowIcon(QIcon(ressource_path(r"ico\trieur.png"))) #Notre logo à l'emplacement relatif au dossier d'execution
        self.setStyleSheet("background-color: #1c1c1c; color: white;")
        self.setWindowFlag(Qt.WindowMaximizeButtonHint, False) #On epeche le redimensionnement de la fenetre
        self.setWindowFlag(Qt.MSWindowsFixedSizeDialogHint, True) 


#Contenu principal, du premier jusqu'au dernier bouton en commençant par celui pour rechercher notre liste :
        self.list = QPushButton("Liste.txt", self)
        f_list = self.list.font() #On parametre une typo
        f_list.setPointSize(16) #On lui assigne une taille
        self.list.setFont(f_list) #On assigne la typo à l'objet la contenant
        self.list.setStyleSheet("background-color: yellow; color: black;") #On assigne une couleur de fond à notre widget, une couleur de police.
        self.list.move(50, 20) #On  place le bouton dans notre fenetre (encore une fois largeur, hauteur)
        self.list.clicked.connect(self.openFile) #On lui assigne sa commande de dedamnder à l'utilisateur de chercher la liste.

#Affichage du titre "Cote Akoun"
        self.cote = QLabel(self)
        self.cote.setText("COTE AKOUN :")
        f_cote = self.cote.font()
        f_cote.setPointSize(11)
        self.cote.setFont(f_cote)
        self.cote.setStyleSheet("color: white;") 
        self.cote.move(50, 66)
        
#Objet ou l'utilisateur peut écrire sa cote        
        self.cote_akoun = QLineEdit(self)
        f_cote_akoun = self.cote_akoun.font()
        f_cote_akoun.setPointSize(18)
        self.cote_akoun.setFont(f_cote_akoun)
        self.cote_akoun.setStyleSheet("color: white;")  
        self.cote_akoun.setValidator(QIntValidator()) #Oblige à ne rentrer que nes nombres
        self.cote_akoun.move(50, 100)

#Bouton "valider" qui lance notre script une fois tout les parametres établis
        self.launch = QPushButton("Valider", self)
        f_launch = self.launch.font()
        f_launch.setPointSize(18)
        self.launch.setFont(f_launch)
        self.launch.setStyleSheet("background-color: yellow; color: black;")
        self.launch.move(50, 150)
        self.launch.clicked.connect(self.validation) #La commande de lancement

#On définit une barre de défilement pour le tuto apparaissant juste apres 
        self.scroller = QScrollArea(self)
        self.scroller.setWidgetResizable(True)
        self.scroller.setFixedSize(180, 100)
        self.scroller.move(10, 200)


#Maintenant on  définit notre tutoriel en fonction de notre barre de défilement via du HTML
        self.message = QTextEdit(self.scroller)
        self.message.setText(
                                                                                                                                "<br>"
            "<center>TUTORIEL :</center> "
                                                                                                                                "<br><br>"
            "Si ce tutoriel n'est pas assez ergonomique pour vous, "
                                                                                                                                "<br>"
            "vous pouuvez toujours copier le texte en utilisant les touches ctrl+A"
                                                                                                                                "<br>"
            "puis coller le texte dans un autre document, un bloc note par exemple,"
                                                                                                                                "<br>"
            "ou tout simplement lire le README.md disponnible la ou vous avez télécharger ce programme"    
                                                                                                                                "<br><br>"
            "Notez que les dossiers / listes seront créées à l'emplacement ou vous lancerez le programme."  
                                                                                                                                "<br>" 
            "Si les dossiers ou des listes au meme nom que le type d'oeuvre existent déja,"
                                                                                                                                "<br>" 
            "les données viendront s'y ajouter sans rien supprimer "                                                                                                                               
                                                                                                                                "<br><br><br>"
            "<center>Utilisation :</center> "
                                                                                                                                "<br><br>"
            "Utilisez le bouton liste.txt pour rechercher votre liste à trier au format.txt "
                                                                                                                                "<br><br>"
            "Le format de votre liste doit ressembler à ca :  "
                                                                                                                                "<br><br>"
            "1 3D 300 200 0 le petit charles   "                                  
                                                                                                                                "<br>"
            "2 numerique 200 50 1 jean-luc "
                                                                                                                                "<br>"
            ". . . " 
                                                                                                                                "<br><br>"
            "soit avec un esapace entre chaques valeurs, <b> sans caractères spéciaux (é, /, ...)</b>: "
                                                                                                                                "<br><br><br>"
            "1.Le numero"
                                                                                                                                "<br><br>"
            "2.Le type d'oeuvre <b>EN UN SEUL MOT</b>"
                                                                                                                                "<br><br>"  
            "3.La longueur"
                                                                                                                                "<br><br>"
            "4.La largeur"
                                                                                                                                "<br><br>"
            "5.La profondeur, <b>mettez 1 ou 0 pour une oeuvre papier ou numérique</b>"
                                                                                                                                "<br><br>"
            "6.Le titre de l'oeuvre"
                                                                                                                                "<br><br><br>"
            "Maintenant, inscrivez votre cote AKOUN. "
                                                                                                                                "<br><br><br>"
            "Enfin, Appuyez sur le bouton valider pour lancer un tri automatique des données"
            )

        f_tuto = self.message.font()
        f_tuto.setPointSize(14)
        self.message.setFont(f_tuto)
        self.message.setStyleSheet("background-color : #404040; color : white; border: 1px solid black;") 
        self.message.setReadOnly(True) #On empeche la réécriture dans la fenetre de tutoriel

        self.scroller.setWidget(self.message) #On assigne la scrollbar au message



#On finit par afficher la fenetre
        self.show()
        

#Maintenant on définit notre fonction permettant d'ouvrir notre liste.txt
    def openFile(self):
        options = QFileDialog.Options()
        options |= QFileDialog.ReadOnly #On parametre le fichier en lecture seule pour éviter que l'utilisateur fasse des trucs bizzares avec en meme temps
        fileName, _ = QFileDialog.getOpenFileName(self, "Ouvrir votre liste", "", "Text Files (*.txt);;All Files (*)", options=options)
        if fileName: 
            self.fileName = fileName #On stock notre fichier dans cette variable

#La fonction permettant le tri :
    def validation(self):
            self.akoun  = int(self.cote_akoun.text()) #On commence par créer une variable pour la cote AKOUN
        
            if hasattr(self, 'fileName'): #Si un fichier texte a bien été ouvert, on récupères les données à l'interieur
                with open(self.fileName, "r") as f:
                    lines = f.readlines()
                data = {}

#On va maintenant récupérer les mots pour chaque lignes et les assigner à des variables 
                for line in lines:
                    elements = line.split() #On transforme les lignes en "phrases"
                    num = elements[0] #Le premier "mot" de la liste sera attribué au numéro de la ligne
                    data[num] = {}
                    data[num]["type"] = elements[1] #le 2eme "mot" sera le type et ainsi de suite
                    data[num]["longueur"] = int(elements[2])
                    data[num]["largeur"] = int(elements[3])
                    data[num]["profondeur"] = int(elements[4])
                    data[num]["nom"] = " ".join(elements[5:])
    
                    if elements[4] in ["0"]: #Si la profondeur est de 0, pour éviter les erreurs de calculs, on remplace la valeur par 1.
                        data[num]["profondeur"] = 1

#On calcul maintenant la valeur de l'oeuvre : (longuer x largeur x profondeur x la cote AKOUN)/3250
                    data[num]["prix"] = round((data[num]["longueur"] * data[num]["largeur"] * data[num]["profondeur"] * self.akoun) / 3250)

                    os.makedirs(data[num]["type"], exist_ok=True) #On regarde si les dossiers/fichiers écris dans ala variable "type" existent, si c'est le cas on écrira a l'interieur, sinon on en créera de nouveaux

#Pour finir on tri nos fichiers et on les envois la ou ils doivent etre     
                    if elements[4] in ["0","1"]:  #Pour les fichiers n'ayant pas de profondeur, on n'affichera pas cette dernière dans les liste.            
                        with open(f"{data[num]['type']}/{data[num]['type']}.txt","a") as f: #On ouvre chaque "phrases"

                            f.write(f"{num} {data[num]['type']} {data[num]['nom']} {data[num]['longueur']}cm x {data[num]['largeur']}cm  {data[num]['prix']} €  \n") #On place les éléments dans l'ordre et on écrit

#Ouvre le fichier, ne fonctionne pas pour le moement                            
#                            path = os.path.dirname(os.path.abspath(__file__))
#                            os.startfile(path)  #Pour montrer la ou les dossiers ont été créer, et surtout démontrer que tout s'est déroulé sans encombres.
                    else :
                        with open(f"{data[num]['type']}/{data[num]['type']}.txt", "a") as f:
                            f.write(f"{num} {data[num]['type']} {data[num]['nom']} {data[num]['longueur']}cm x {data[num]['largeur']}cm x {data[num]['profondeur']}cm {data[num]['prix']} € \n")
#                            path = os.path.dirname(os.path.abspath(__file__))
#                            os.startfile(path)

        

#____ ____ ____ _  _ ____ ___    _    ____ _  _ _  _ ____ _  _
#|__/ |  | |    |_/  |___  |     |    |__| |  | |\ | |    |__|
#|  \ |__| |___ | \_ |___  |     |___ |  | |__| | \| |___ |  |


#Pour finir on lance notre application 
if __name__ == "__main__":
    app = QApplication(sys.argv)
    window = trieur()
    sys.exit(app.exec_())
