#          ████████     ██████
#         █░░░░░░░░██_██░░░░░░█
#        █░░░░░░░░░░░█░░░░░░░░░█
#       █░░░░░░░███░░░█░░░░░░░░░█
#       █░░░░███░░░███░█░░░████░█
#     █░░░██░░░░░░░░███░██░░░░██
#    █░░░░░░░░░░░░░░░░░█░░░░░░░░███
#    █░░░░░░░░░░░░░██████░░░░░████░░█
#    █░░░░░░░░░█████░░░████░░██░░██░░█
#   ██░░░░░░░███░░░░░░░░░░█░░░░░░░░███
#  █░░░░░░░░░░░░░░█████████░░█████████
# █░░░░░░░░░░█████ ████   ████ █████ █
# █░░░░░░░░░░█      █ ███   █   ███ █ █
#█░░░░░░░░░░░░█   ████ ████    ██ ████
#░░░░░░░░░░░░░█████████░░░████████░░░█
#░░░░░░░░░░░░░░░░█░░░░░█░░░░░░░░░░░░█
#░░░░░░░░░░░░░░░░░░░░██░░░░█░░░░░░██
#░░░░░░░░░░░░░░░░░░██░░░░░░░███████
#░░░░░░░░░░░░░░░░██░░░░░░░░░░█░░░░░█                                            _____                                 _____                                            _____                                                   _____
#░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░█                                          /\    \                               /\    \                                          /\    \                                                 /\    \
#░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░█                      ::                 /::\    \                             /::\    \                                        /::\____\                                               /::\____\
#░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░█                                        /::::\    \                           /::::\    \           :::         ::           ::: ::/    /                         :                   :: ::/    /
#░░░░░░░░░░░█████████░░░░░░░░░░░░░░██                                       /::::::\    \                         /::::::\    \                               ::: : :::/    /                                              /:::/    /
#░░░░░░░░░░█▒▒▒▒▒▒▒▒███████████████▒▒█                                     /:::/\:::\    \                    :: ::::/\:::\    \                                  /:::/    /                                              /:::/    /
#░░░░░░░░░█▒▒███████▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒█                                    /:::/__\:::\    \                     /:::/__\:::\    \                                /:::/    /                                            :::: :/____/
#░░░░░░░░░█▒▒▒█▓▓▓▓██████████████████                                    /::::\   \:::\    \                   /::::\   \:::\    \                              /:::/    /                                              /::::\    \
#░░░░░░░░░██▒▒█▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█                                       /::::::\   \:::\    \                 /::::::\   \:::\    \                            /:       /      _____                                   /::::::\    \   _____
#░░░░░░░░░░█▒▒█▓█████████████████ ████                                 /:::/\:::\   \:::\ ___\               /:::/\:::\   \:::\____\                          /:::/____/      /\    \                                 /:::/\:::\    \ /\    \
#░░░░░░░░░░█▒▒██▓▓▒▓▒▓▒▓▒▒▒▒▒▒▒▒▓█▓▒▒▒█                               /:::/__\:::\   \:::|    |             /:::/  \:::\   \:::|    |                         :::|    /      /::\____\                        ::::::: :::/ : :::\    /::\____\
#░░░░░░░░░█▒▒████████▓▒███▓██▒▒▒▒▒▒▒▒▒█                  :            \:::\   \:::\  /:::|____|             \::/   |::::\  /:::|____|                      : :: :|____\     /:::/    /                               \::/    \:::\: ::::/    /
#░░░░░░░░░█▒▒▒▒▒▒▒▒▒█████████████▓█▓██                                 \:::\   \:::\/:::/    /               \/____|:::::\/:::/    /                          \:::\    \   /:::/    /                                 \/____/: :::\/:::/    /
#░░░░░░░░░░████████▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒█                                  \:::\   \::::::/    /                      |:::::::::/    /                            \:::\   :: : ::/    /                                 :  :  : : :::::::/    /
#░░░░░░░░░░░░░░░░░░██████████████████                                    \:::\   \::::/    /          :  :         |::|\::::/    /           ::                 \:::\    /:::/    /               ::::                          \::       /
#░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░█            ::                           \:::\  /:::/    /                      :: ::| \::/____/                                \:::\__/:::/    /                                              /:::/    /
#██░░░░░░░░░░░░░░░░░░░░░░░░░░░██                                           \:::\/:::/    /                         |::|  ~|                                       \::::::::/    /                                             : :::/    /
#▓██░░░░░░░░░░░░░░░░░░░░░░░░██                                              \::::::/    /                          |::|   |                                        \::::::/    /                                              /:::/    /
#▓▓▓███░░░░░░░░░░░░░░░░░░░░█                                                 \::::/    /                           \::|   |                                         \::::/    /                              ::: :           /:::/    /
#▓▓▓▓▓▓███░░░░░░░░░░░░░░░██                                 :                 \::/____/            :                \:|   |               :    ::::                  \::/____/                                               \::/    /
#▓▓▓▓▓▓▓▓▓███████████████▓▓█                                                   ⠋                                     \|___|                                           ⠩                                                      \/____/
#▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓██
#▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█                                                                                                                                                                                                                                               |                                                                    |                                      |
#▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█                                                                    |                                                                                                             |
#______________________________                                                                                                                       |                                                                                                                      |                                                                                                                                              |                    |
#___________________________
#_ ______ _____ _________
# /            /                                                         |                                |                       |                    |                |                       |                    |                |                       |                    |                     |                       |                    |

#        \                          |                                |                                               |  |                                          |                    |                                          |                       |                    |  |                                           |                    |        |                    |                              |


#      |               |                                 |

#                  |                                                |            |                                   |                               |                           |                               |                           |                               |                                |                               |
#           |                                  |                                     |

#                  |                     |                                                     |                                   |                               |     |                                   |                               |     |                                   |                               |          |                                   |                               |
#   |                          |                       |                    |
#           |                                    |                                         |     |                    |                                    | |     |                    |                                    | |     |                    |                                    |      |     |                                                        |
#      |                        |                                 |      |                                |                       |                    |                |                       |                    |                |                       |                    |                     |                       |                    |

#                      |                                                |      |                                   |                               |                         |                               |                         |                               |                              |                               |
#           |                                   |                               |                   |                                |                       |                    |          |                                |                       |                    |          |                                |                       |                    |               |                                |                                        |

#                  |                     |
#   |                                |                       |                    |            |                                |                       |                    |     |                                |                       |                    |     |                                |                       |                              |                                |
#           |                               |                                         |                              |                       |                    |                           |                       |                    |                           |                       |                    |                                |                       |                    |

#   |         |                                   PRESENTATION                                                |                                |                    |   |                                |                    |   |                                |                    |        |                                |                    |
#                                                                                                                               |                               |     |                                   |                               |     |                                   |                               |          |                                   |                               |
#                |                            |                 |                          |                                                                              |                               |     |                                   |                               |     |                                   |                               |          |                                   |                               |

#        |                         Ce trieur permet de calculer le prix plus

#                              rapidement pour des artistes cotés AKOU tels que                      |                                           |               |                                           |               |                                           |                    |                                           |

#                 Nathacha , artiste peintre de l'abstraction https://www.artnathacha.com/                |                                |                                          |      |                                |                                          |      |                                |                                          |           |                                |
#                                                                                                    |                                                                 |                      |                     |                       |                      |                     |                       |                      |                     |                            |

#      |                        |                                         |                                |                       |                    |                |                       |                    |                |                       |                    |                    |                                           |

#                   |            |                   Anyway          |                        |                                         |                                |                       |                    |                |                       |                    |                |                       |                    |                    |

#              |                      |                 have                                                 |                        |                                         |                                |                       |                    |                |                       |                    |                |                       |                    |                     |                                           |


#                 |                                  FUN         |                        |                                         |                                |                       |                    |                |                       |                    |                |                       |                    |                    |                                                                      |

#                                                         =)

#
#                                |                      or                                       |                                                            |                    |                |                       |                    |                |                       |                    |                    |                                           |


#              |                              |       DIE ! !         |                       |                            |                |                       |                    |                |                       |                    |                    |                                           |#      |                        |                                         |                                |

#
#                                                     !                                       |                                |                    |  |                                |                    |  |                                |                    |       |                                |                    |

#      |               |                                 !

#                  |                                                |            |                                   |                               |                           |                               |                           |                               |                                |                               |
#           |                                  !                                     |

#                  |                     |                                                     |                                   |                               |     |                                   |                               |     |                                   |                               |          |                                   |                               |
#   |                          |                       |                    |
#           |                                    |                                         |     |                    |                                    | |     |                    |                                    | |     |                    |                                    |      |     |                    |                                    |
#      |                        |                                 |      |                                |                       |                    |                |                       |                    |                |                       |                    |                    |                                           |

#                      |                                                |      |                                   |                               |                         |                               |                         |                               |                              |                               |
#           |                                   |                               |                   |                                |                       |                    |          |                                |                       |                    |          |                                |                       |                    |               |                                                                |

#                  |                     |
#   |                                |                       |                    |            |                                |                       |                    |     |                                |                       |                    |                                    |                       |                              |                                                                        |
#           |                               |                                         |                              |                       |                    |                           |                       |                    |                           |                       |                    |                                |                       |                    |

#_ _  _ ____ ___ ____ _    _    ____ ___ _ ____ _  _
#| |\ | [__   |  |__| |    |    |__|  |  | |  | |\ |
#| | \| ___]  |  |  | |___ |___ |  |  |  | |__| | \|


import os
import re
import time
import sys
from PIL import Image
from unidecode import unidecode
from PyQt5.QtWidgets import QApplication, QMainWindow, QPushButton, QFileDialog, QLabel, QLineEdit, QScrollArea, QCheckBox, QVBoxLayout, QWidget, QMessageBox, QTextBrowser, QHBoxLayout
from PyQt5.QtGui import QIntValidator, QIcon
from PyQt5.QtCore import Qt


#___  ____ _ _ _ ____ ____    ___  _    ____ _  _ ___
#|__] |  | | | | |___ |__/    |__] |    |__| |\ |  |
#|    |__| |_|_| |___ |  \    |    |___ |  | | \|  |


#OPENING | https://www.youtube.com/watch?v=_85LaeTCtV8 :3

#Fonction pour créer un executable

def ressource_path(relative_path):
    try:
        base_path=sys._MEIPASS

    except Exception:
        base_path = os.path.abspath('.')

    return os.path.join(base_path ,relative_path)

# Pour que la création d'un fichier executable s'effectue, il faut inclure tout les chemins relatif dans ressource_path()
# Exemple : 
# /icon/lol.png  DEVIENT  ressource_path(/icon/lol.png)
# idem dés que l'on ouvre un fichier relatif en lecture, ou en écriture.



#___  ____ ____ ____ ____ ____ _  _
#|__] |__/ |  | | __ |__/ |__| |\/|
#|    |  \ |__| |__] |  \ |  | |  |


#Création d'une classe contenant nos fonctions et boutons principaux
class trieur(QMainWindow):
    def __init__(self):
        super().__init__()
        self.GUI()
        

#On passe mainteant à la création de la fenetre utilisateur :

    def GUI(self):

        self.setFixedSize(200,500) #La taille largeur, hauteur
        self.setWindowTitle("TRI") 
        self.setWindowIcon(QIcon(ressource_path(r"ico\trieur.png"))) #Notre logo à l'emplacement relatif au dossier d'execution
        self.setStyleSheet("background-color: #1c1c1c; color: white;")



#Contenu principal, du premier jusqu'au dernier bouton en commençant par celui qui créer notre liste
        self.list_maker = QPushButton("Créer une liste", self) # Voila un tuto pour la compréhension de la notion "self" : https://www.edureka.co/blog/self-in-python/#what )
        f_list_maker = self.list_maker.font() #On parametre une typo
        f_list_maker.setPointSize(16) #On lui assigne une taille
        self.list_maker.setFont(f_list_maker) #On assigne la typo à l'objet la contenant
        self.list_maker.setStyleSheet("background-color: yellow; color: black;") #On assigne une couleur de fond à notre widget, une couleur de police.
        self.list_maker.clicked.connect(self.list_making)


#On créer une checkbox pour savoir si la liste se fait à propos d'oeuvres numériques ou non
        self.digital_checkbox = QCheckBox("Oeuvres numérique", self)
        f_digital_checkbox = self.digital_checkbox.font()
        f_digital_checkbox.setPointSize(12)
        self.digital_checkbox.setFont(f_digital_checkbox)
        self.digital_checkbox.setStyleSheet("color: white;") 
        self.digital_checkbox.stateChanged.connect(self.digital_checker)
        self.digital_checkbox.setChecked(True)

#Boutton pour rechercher notre liste :
        self.list = QPushButton("Chercher la liste", self)
        f_list = self.list.font() 
        f_list.setPointSize(16) 
        self.list.setFont(f_list) 
        self.list.setStyleSheet("background-color: yellow; color: black;") 
        self.list.clicked.connect(self.openFile) #On lui assigne sa commande de dedamnder à l'utilisateur de chercher la liste.

#Affichage du titre "Cote Akoun"
        self.cote = QLabel(self)
        self.cote.setText("ENTRER COTE AKOUN :")
        f_cote = self.cote.font()
        f_cote.setPointSize(11)
        self.cote.setFont(f_cote)
        self.cote.setStyleSheet("color: white;") 

        
#Objet ou l'utilisateur peut écrire sa cote        
        self.cote_akoun = QLineEdit(self)
        f_cote_akoun = self.cote_akoun.font()
        f_cote_akoun.setPointSize(18)
        self.cote_akoun.setFont(f_cote_akoun)
        self.cote_akoun.setStyleSheet("color: white;")  
        self.cote_akoun.setValidator(QIntValidator()) #Oblige à ne rentrer que nes nombres


#Bouton "valider" qui lance notre script une fois tout les parametres établis
        self.launch = QPushButton(" GO ", self)
        f_launch = self.launch.font()
        f_launch.setPointSize(18)
        self.launch.setFont(f_launch)
        self.launch.setStyleSheet("background-color: yellow; color: black;")

        self.launch.clicked.connect(self.validation) #La commande de lancement

#On définit une barre de défilement pour le tuto apparaissant juste apres 
        self.scroller = QScrollArea(self)
        self.scroller.setWidgetResizable(True)
        self.scroller.setFixedSize(180, 180)
        self.scroller.move(10, 300)

#Maintenant on  définit notre tutoriel en fonction de notre barre de défilement via du HTML
        self.tuto = QTextBrowser(self.scroller) #On utilise QTextBrowser pour pouvoir cliquer sur les liens dans le texte
        self.tuto.setOpenExternalLinks(True) #On active le clic sur les liens.

        #Oui je sais c'est extremement schlag mais j'ai pas de meilleure méthode pour que ca soit lisible dans le code ^^'
        self.tuto.setText(
                                                                                                                                "<br>"
            "<center>TUTORIEL :</center> "
                                                                                                                                "<br><br>"
            "Si ce tutoriel n'est pas assez ergonomique, "
                                                                                                                                "<br>"
            "vous pouvez toujours copier le texte en utilisant les touches ctrl+A"
                                                                                                                                "<br>"
            "puis coller le texte dans un autre document, un bloc note par exemple."
                                                                                                                                "<br><br>"
            "Vous pouvez également lire le README.md disponible ici : "
                                                                                                                                "<br><br>"
            "- <a href='https://github.com/SECRET-GUEST/trieur' style='color: #F2F2F2;'><b>GITHUB</b></a> ." 
                                                                                                                                "<br><br>"
            "Notez que les dossiers / listes seront créées à l'emplacement ou vous lancerez le programme."  
                                                                                                                                "<br><br>" 
            "Si les dossiers ou des listes au meme nom que le type d'oeuvre existent déja,"
                                                                                                                                "<br>" 
            "les données viendront simplement s'y ajouter"                                                                                                                               
                                                                                                                                "<br><br><br>"
            "<center>Utilisation :</center> "
                                                                                                                                "<br><br>"
            "Tout d'abord, il faut noter que la création de liste va renommer toute les images du dossier selectionné, "
                                                                                                                                "<br>"
            "remplacant TOUT les caractères spéciaux par des caractères normaux ou des espaces."
                                                                                                                                "<br><br>"
            "Utilisez le bouton création de liste pour avoir une liste conforme, "
                                                                                                                                "<br>"
            "mais vérifiez la quand meme, il vaut mieux la retravailler au besoin. "
                                                                                                                                "<br><br>"
            "Le bouton oeuvres numérique sert à determiner les propriétés physique."
                                                                                                                                "<br><br>"
            "Utilisez le bouton cherche liste pour rechercher votre liste à trier au format.txt "
                                                                                                                                "<br><br>"
            "Le format de votre liste doit ressembler à ca :  "
                                                                                                                                "<br><br>"
            "1 3D 300 200 0 le petit charles   "                                  
                                                                                                                                "<br>"
            "2 numerique 200 50 1 jean-luc "
                                                                                                                                "<br>"
            ". . . " 
                                                                                                                                "<br><br>"
            "soit avec un esapace entre chaques valeurs, <b> sans caractères spéciaux (é, /, ...)</b>: "
                                                                                                                                "<br><br><br>"
            "1.Le numero"
                                                                                                                                "<br><br>"
            "2.Le type d'oeuvre <b>EN UN SEUL MOT</b>"
                                                                                                                                "<br><br>"  
            "3.La longueur"
                                                                                                                                "<br><br>"
            "4.La largeur"
                                                                                                                                "<br><br>"
            "5.La profondeur, <b>mettez 1 ou 0 pour une oeuvre papier ou numérique</b>"
                                                                                                                                "<br><br>"
            "6.Le titre de l'oeuvre"
                                                                                                                                "<br><br><br>"
            "Maintenant, inscrivez votre cote AKOUN. "
                                                                                                                                "<br><br><br>"
            "Enfin, Appuyez sur le bouton valider pour lancer un tri automatique des données"
            )

        f_tuto = self.tuto.font()
        f_tuto.setPointSize(12)
        self.tuto.setFont(f_tuto)
        self.tuto.setStyleSheet("background-color : #404040; color : white; border: 1px solid black;") 
        self.tuto.setReadOnly(True) #On empeche l'écriture dans la fenetre de tutoriel
        self.scroller.setWidget(self.tuto) #On assigne la scrollbar au message

#On place nos éléments dans une colone verticale, un layout
        layout = QVBoxLayout()

        layout.addSpacing(10) # On espace les éléments dans la grille
        layout.addWidget(self.list_maker) #On les place
        layout.addWidget(self.digital_checkbox)
        layout.addSpacing(20)
        layout.addWidget(self.list)
        layout.addSpacing(20)
        layout.addWidget(self.cote)
        layout.addWidget(self.cote_akoun)
        layout.addSpacing(20)
        layout.addWidget(self.launch)
        layout.addSpacing(10)
        layout.addWidget(self.scroller)
        

#On centralise les widgets, les éléments que l'on a créé dans notre grille
        widget = QWidget(self)
        widget.setLayout(layout)
        self.setCentralWidget(widget)

#On finit par afficher la fenetre
        self.show()



#_    _ ____ ___    _  _ ____ _  _ _ _  _ ____ 
#|    | [__   |     |\/| |__| |_/  | |\ | | __ 
#|___ | ___]  |     |  | |  | | \_ | | \| |__]                                                


#Toujours dans notre fenetre, on va maintenant definir les fonctions appelées

#On crée une fonction pour vérifier l'état (coché ou non) de la checkbox
    def digital_checker(self, state):
        try:
            self.digital = state == Qt.Checked

        except:
            #Code à exécuter en cas d'erreur
            QMessageBox.warning(self, "GAME OVER", "Essayez de cocher / décocher la case numérique")

#Maintenant on crée notre liste à partir des données
    def list_making(self):

        global folder #Folder étant le chemin de notre dossier, on le veut en global pour le réutiliser lors de la sauvegarde de la liste

#On demande dans un premier temps de rechercher le dossier concerné par l'élaboration de notre liste :
        try :
            options = QFileDialog.Options()
            options |= QFileDialog.ReadOnly #On ouvre le dossier en lecture seule
            folder = QFileDialog.getExistingDirectory(self, "Open Folder", "",options=options) #On récupère le path du dossiers choisis

            #Cette partie sert à éviter les erreurs de selection de dossier :
            if folder:
                self.folder = folder

            if not folder: 
                return 

        except:
            QMessageBox.warning(self, "GAME OVER", "Vous n'avez pas selectionner un dossier valide")



#On commence par renommer toute les images du dossier remplacant les caracteres speciaux par des espaces.
#Il serait effectivement plus simple de le faire à la lecture des fichiers, mais ca permet de clean notre dossier.

        #Pour tout les fichiers du dossier selectionné
        files = [f for f in os.listdir(folder) if os.path.isfile(os.path.join(folder, f))] 
        #Si il y a des fichiers
        for file in files: 
            #On lit leurs noms
            old = os.path.join(folder, file) 

            #On sépare l'extension de l'image 
            filename, extension = os.path.splitext(file)

            #Puis on remplace les lettres accentué avec unidecode, par des lettres standard, ainsi que TOUT les caractères spéciaux par des espaces 
            new_filename = re.sub(r'[^a-zA-Z0-9]+', ' ', unidecode(filename))

            #On rajoute le nouveau nom dans le dossier, suivi de l'extension.
            new = os.path.join(folder, new_filename + extension)

            os.rename(old, new) #On renomme les anciens fichiers par leur nouveaux noms.


#5 secondes de chargement, le temps de tout renommer afin d'éviter les erreurs
        time.sleep(5)


#Après avoir cleaner le dossier, on va maintenant une liste vide qui contiendra nos images
        images = []

#On regarde si le dossier contient des images, peu importe si l'extension contient des majuscules.
        for filename in os.listdir(folder): 
            if not filename.lower().endswith(".jpg") and not filename.lower().endswith(".jpeg") and not filename.lower().endswith(".png"):
                continue

#On définit ce qu'il y aura dans la liste :
            #On commence par numéroter +1 nos images
            image_info = {"num": len(images) + 1}

            #Ensuite on écris le nom du dossier ou elles se situent
            image_info["type"] = os.path.basename(folder) 

            try :
#Maintenant, on va convertir les pixels en cm pour notre liste si elle s'établie selon des oeuvres numérique :
                if self.digital:
                    picture = Image.open(os.path.join(folder, filename)) #Pour chaque images dans le dossier
                    width, height = picture.size #On récupère la taille en pixel



#On a maintenant 2 manières de procéder: 
#----------------> La première en utilisant un ratio fixe, 1cm = 37.79527559055 pixels.

#                    ratio = 37.79527559055 
#                    width_cm = round(width / ratio)
#                    height_cm = round(height / ratio)

#----------------> La seconde en utilisant la résolution de l'image :
                    Image.MAX_IMAGE_PIXELS = None #Supprime la restriction liée à la taille de l'image pour éviter les erreurs

                    dpi = picture.info.get("dpi", (300, 300)) #Une résolution par défaut de 300 DPI sera appliquée aux images dont on a pas les informations.
                    width_cm = round(width / dpi[0] * 2.54)
                    height_cm = round(height / dpi[1] * 2.54)

# l'utilisation des DPI est bien plus précis notamment pour l'élaboration d'une taille d'impression.
# cependant l'utilisation du ratio est peut etre plus interessant dans éviter les erreurs de compression


                    #On finit par inscrire dans la liste les valeurs en cm
                    image_info["longueur"] = width_cm
                    image_info["largeur"] = height_cm

            except:
                QMessageBox.warning(self, "GAME OVER", "Il y a un probleme concernant la résolution des images, ou leur taille \n\n je vais tenter d'appliquer un ratio standard (1cm = 37.79527559055 pixels) \n\n Ce ne sera pas super précis, il vaudrait mieux modifier les images et recommencer")
                try :
                    if self.digital:
                        picture = Image.open(os.path.join(folder, filename)) 
                        width, height = picture.size 
                        ratio = 37.79527559055 
                        width_cm = round(width / ratio)
                        height_cm = round(height / ratio)

                        image_info["longueur"] = width_cm
                        image_info["largeur"] = height_cm
                except:
                    QMessageBox.warning(self, "GAME OVER", "Il y a un serieux probleme avec les metadonnées des images, \n\n Je n'arrive pas à récupérer les informations de longueur x largeur pour les transformer")
                    return

             #On donne une profondeur par défaut de 1
            image_info["profondeur"] = 1

            #On termine notre liste en donnant le nom exact avec son extension dans le fichier
            image_info["nom"], _ = os.path.splitext(os.path.basename(filename))

            #On ajoute alors les infos à notre liste
            images.append(image_info)

        #On finit par appeler notre fonction pour sauvegarder les éléments dans le meme dossier dans une liste 0list.txt 
        # (le 0 devant permettant d'afficher la liste avant les images si elles sont triées par nom, pour plus de lisibilité)
        self.save_list(images, os.path.join(folder, "0list.txt"))
        
        #On terminera en affichant un pop up expliquant que le script a bien fonctionné.
        QMessageBox.information(self, "Information", "Le tri s'est bien effectué. \n J'ai créé la liste dans le dossier concerné")

# Enregistrement de la liste :
    def save_list(self, image_list, filename): # Pour l'enregistrement de la liste depuis toute les images, dans le dossier choisi.

        try :        
            filepath = os.path.join(folder, filename) # On enregistrera dans le dossier du nom choisi

            with open(ressource_path(filepath), "w", encoding='utf-8') as f: # Une nouvelle liste supprimant une ancienne du meme nom (changer w par a pour append, pour qu'elles s'ajoute à la suite)

                for image_info in image_list: #Pour les informations d'image dans notre liste d'images
                    line = "{num} {type}".format(**image_info) #On commence par enregistrer le numéro de l'image, son type

                    if self.digital: # Si les oeuvres concernées sont numérique, on ajoute automatiquement la longueur, largeur et profondeur en cm
                        line += " {longueur} {largeur} {profondeur}".format(**image_info)

                    line += " {nom}\n".format(**image_info) # On rajoute le nom complet de l'image.png

                    f.write(line) # On recommence à la ligne pour chaque nouvelle image

        except:
             QMessageBox.warning(self, "GAME OVER", "Il y a eu un probleme lors de l'enregistrement de la liste")
             return


#____ ____ ____ ___    _    _ ____ ___ 
#[__  |  | |__/  |     |    | [__   |  
#___] |__| |  \  |     |___ | ___]  |  
                                      
                   

#Maintenant on définit notre fonction permettant d'ouvrir notre liste.txt
    def openFile(self):
        options = QFileDialog.Options()
        options |= QFileDialog.ReadOnly 
        fileName, _ = QFileDialog.getOpenFileName(self, "Ouvrir votre liste", "", "Text Files (*.txt);;All Files (*)", options=options)

        if fileName: 
            self.fileName = fileName
            with open(ressource_path(fileName), "r") as file:
                data = file.read()

#La fonction permettant le tri :
    def validation(self):
            self.akoun  = int(self.cote_akoun.text()) #On commence par créer une variable pour la cote AKOUN
        
            try:
                if hasattr(self, 'fileName'): #Si un fichier texte a bien été ouvert, on récupères les données à l'interieur
                    with open(ressource_path(self.fileName), "r") as f:
                        lines = f.readlines()
                    data = {}

#On va maintenant récupérer les mots pour chaque lignes et les assigner à des variables 
                    try:
                        for line in lines:
                            elements = line.split() #On transforme les lignes en "phrases"
                            num = elements[0] #Le premier "mot" de la liste sera attribué au numéro de la ligne
                            data[num] = {}
                            
                            try:
                                data[num]["type"] = elements[1] #le 2eme "mot" sera le type et ainsi de suite
                            except:
                                    QMessageBox.warning(self, "GAME OVER", "Il y a un probleme avec le nom du dossier : \n\n Il est probable que la liste ne soit pas au bon format \n\n consultez le tutoriel pour + d'infos")
                                    return
                            try:
                                data[num]["longueur"] = int(elements[2])
                            except:
                                    QMessageBox.warning(self, "GAME OVER", "Il y a un probleme avec la longueur d'une image : \n\n Il est probable que la liste ne soit pas au bon format \n\n consultez le tutoriel pour + d'infos")
                                    return

                            try:
                                data[num]["largeur"] = int(elements[3])
                            except:
                                    QMessageBox.warning(self, "GAME OVER", "Il y a un probleme avec la largeur d'une image : \n\n Il est probable que la liste ne soit pas au bon format \n\n consultez le tutoriel pour + d'infos")
                                    return
                            try:
                                data[num]["profondeur"] = int(elements[4])
                            except:
                                    QMessageBox.warning(self, "GAME OVER", "Il y a un probleme avec la profondeur d'une image : \n\n Il est probable que la liste ne soit pas au bon format \n\n consultez le tutoriel pour + d'infos")
                                    return
                            try:
                                data[num]["nom"] = " ".join(elements[5:])
                            except:
                                    QMessageBox.warning(self, "GAME OVER", "Il y a un probleme avec le nom d'une image : \n\n Il est probable que la liste ne soit pas au bon format \n\n consultez le tutoriel pour + d'infos")
                                    return

                            if elements[4] in ["0"]: #Si la profondeur est de 0, pour éviter les erreurs de calculs, on remplace la valeur par 1.
                                data[num]["profondeur"] = 1


#On calcul maintenant la valeur de l'oeuvre : (longuer x largeur x profondeur x la cote AKOUN)/3250
                            data[num]["prix"] = round((data[num]["longueur"] * data[num]["largeur"] * data[num]["profondeur"] * self.akoun) / 3250)

                            folder_path = os.path.dirname(os.path.abspath(self.fileName)) # Récupère le chemin du dossier où le fichier a été ouvert
                            directory = os.path.join(folder_path, data[num]["type"]) # Crée le chemin complet pour le nouveau dossier
                            os.makedirs(directory, exist_ok=True) # Crée le nouveau dossier à l'emplacement spécifié

#Pour finir on tri nos fichiers et on les envois la ou ils doivent etre   
                            try:
                                if elements[4] in ["0","1"]:  #Pour les fichiers n'ayant pas de profondeur, on n'affichera pas cette dernière dans les liste.

                                    try :
                                        with open(ressource_path(f"{directory}/{data[num]['type']}.txt"),"a") as f: #On ouvre chaque "phrases"
                                            f.write(f"{num} {data[num]['type']} {data[num]['nom']} {data[num]['longueur']}cm x {data[num]['largeur']}cm  {data[num]['prix']} €  \n") #On place les éléments dans l'ordre et on écrit
                                    except:
                                        QMessageBox.warning(self, "GAME OVER", "Il y a un probleme l'enregistrement de la liste contenant des oeuvres sans profondeur")
                                        return

                                else :
                                    try :    
                                        with open(ressource_path(f"{directory}/{data[num]['type']}.txt"), "a") as f:
                                            f.write(f"{num} {data[num]['type']} {data[num]['nom']} {data[num]['longueur']}cm x {data[num]['largeur']}cm x {data[num]['profondeur']}cm {data[num]['prix']} € \n")
                                    except:
                                        QMessageBox.warning(self, "GAME OVER", "Il y a un probleme l'enregistrement de la liste contenant des oeuvres avec profondeur")
                                        return

                            except:
                                 QMessageBox.warning(self, "GAME OVER", "Il y a un probleme avec la liste choisie")
                                 return
                    except:
                        QMessageBox.warning(self, "GAME OVER", "Il y a eu un probleme avec la récupération des noms dans la liste : \n\n Il est probable que la liste ne soit pas au bon format \n\n consultez le tutoriel pour + d'infos ")
                        return
            except:
                 QMessageBox.warning(self, "GAME OVER", "FELICITATION !!! \n\n Vous m'avez cassé. \n\n L'erreur rencontrée m'est totalement inconnue")
                 return



            #On terminera en affichant un pop up expliquant que le script a bien fonctionné.
            QMessageBox.information(self, "Information", "Je suis entrain de trier correctement tout ca.")


#____ ____ ____ _  _ ____ ___    _    ____ _  _ _  _ ____ _  _
#|__/ |  | |    |_/  |___  |     |    |__| |  | |\ | |    |__|
#|  \ |__| |___ | \_ |___  |     |___ |  | |__| | \| |___ |  |


#Pour finir on lance notre application 
if __name__ == "__main__":
    app = QApplication(sys.argv)
    window = trieur()
    sys.exit(app.exec_())
